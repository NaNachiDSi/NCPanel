import asyncio
from collections import Counter
from pynput.mouse import Controller as MouseController, Button
from pynput.keyboard import Controller as KeyboardController, Key
from twitchio.ext import commands
import time
import random
import os
import logging

logging.basicConfig(level=logging.INFO, format='%(asctime)s - %(message)s')

OAUTH_TOKEN = os.getenv("OAUTH_TOKEN")
BOTNICK = os.getenv("BOTNICK")
CHANNEL = os.getenv("CHANNEL")
INTERVAL = 1

KEY_MAPPING = {
# A - Z, 0 - 9
    ":0": "0",
    "1984": "1",
    "2head": "2",
    "3dart": "3",
    ":3": "3",
    "3head": "3",
    "3heading": "3",
    "3headrave": "3",
    "4weird": "4",
    "4weirdbusiness": "4",
    "5head": "5",
    "60seconds": "6",
    "7tv": "7",
    "8kultrahd": "8",
    ":9": "9",
    "a": "a",
    "adge": "a",
    "adhd": "a",
    "agreeing": "a",
    "aintfuckingnoway": "a",
    "aintnoway": "a",
    "aintnowayintoouterspace": "a",
    "alert": "a",
    "alienfloss": "a",
    "alienparty": "a",
    "alienpls": "a",
    "alienpls2": "a",
    "alienpls3": "a",
    "alienpls6": "a",
    "alienrave": "a",
    "alienunpleased": "a",
    "aloo": "a",
    "aloo": "a",
    "android": "a",
    "angry": "a",
    "applecatrun": "a",
    "apuguitar": "a",
    "apujam": "a",
    "apured": "a",
    "apusquats": "a",
    "areyouagirl": "a",
    "arnoldhalt": "a",
    "ascend": "a",
    "ass": "a",
    "assemble": "a",
    "aufbankrott": "a",
    "aufblock": "a",
    "aufchillovanillo": "a",
    "aufdeutschenhungerzock": "a",
    "aufgebruderstreich": "a",
    "aufhivebann": "a",
    "aufhot": "a",
    "aufkulturschock": "a",
    "auflattenseppmitstock": "a",
    "auflocka": "a",
    "aufmod": "a",
    "aufschillock": "a",
    "aufschmeckedischmackedischmock": "a",
    "austriainternet": "a",
    "austriakisser": "a",
    "aware": "a",
    "awkward": "a",
    "ayo": "a",
    "ayooo": "a",
    "backseating": "b",
    "buhhsiness": "b",
    "buhich": "b",
    "burgenland": "b",
    "bye": "b",
    "baldge": "b",
    "banger": "b",
    "banger": "b",
    "banned": "b",
    "based": "b",
    "bastiansdeutschehungerspiele": "b",
    "bedge": "b",
    "beertime": "b",
    "believers": "b",
    "believers": "b",
    "bingchilling": "b",
    "bitrate": "b",
    "bitti": "b",
    "blablabla": "b",
    "blelele": "b",
    "blessrng": "b",
    "bloonsge": "b",
    "boating": "b",
    "booba": "b",
    "boobapeek": "b",
    "bought": "b",
    "breh": "b",
    "browtf": "b",
    "buhbbles": "b",
    "buhh": "b",
    "buhharrive": "b",
    "buhhaw": "b",
    "buhhbye": "b",
    "buhhcry": "b",
    "buhhddies": "b",
    "buhhlolipop": "b",
    "buhhmeeting": "b",
    "catblobdance": "c",
    "catjam": "c",
    "catsittingverycomfortablearoundacampfirewithitsfriends": "c",
    "cattwerk": "c",
    "catum": "c",
    "catwait": "c",
    "catwink": "c",
    "caught": "c",
    "caughtin4k": "c",
    "cc": "c",
    "chadge": "c",
    "chaosflo": "c",
    "chaosflopls": "c",
    "chatting": "c",
    "cinema": "c",
    "clapping": "c",
    "classic": "c",
    "clean": "c",
    "clown": "c",
    "clueless": "c",
    "coffeetime": "c",
    "coggers": "c",
    "cokebert": "c",
    "cooked": "c",
    "copeless": "c",
    "copium": "c",
    "cowjam": "c",
    "coze": "c",
    "crunch": "c",
    "d:": "d",
    "damn": "d",
    "dance": "d",
    "dancingbananabtd": "d",
    "dankies": "d",
    "danseparty": "d",
    "dark": "d",
    "dawg": "d",
    "death": "d",
    "despairge": "d",
    "detonatebedge": "d",
    "deutschge": "d",
    "devious": "d",
    "diesofbedge": "d",
    "diesofcringe": "d",
    "dinkdonk": "d",
    "dinkdonk": "d",
    "dinocry": "d",
    "discord": "d",
    "dogedance": "d",
    "doglookingsussyandcold": "d",
    "donkdrip": "d",
    "donowall": "d",
    "donowall": "d",
    "doyoufeeltheweightofyoursinsdoesithurtdoesgodsjudgementfillyouwithguilttormenttheyrecomingtheyrecomi": "d",
    "dustinkst": "d",
    "dvd": "d",
    "eboy": "e",
    "ed": "e",
    "edm": "e",
    "elmofire": "e",
    "elprimo": "e",
    "entireshrekmovie": "e",
    "essaying": "e",
    "evilowo": "e",
    "ez": "e",
    "ezclap": "e",
    "fabo": "f",
    "faister": "f",
    "faisterhappy": "f",
    "fance": "f",
    "fatasswizardblicky": "f",
    "fatasswizardblicky2": "f",
    "fatasswizardbozo": "f",
    "fatasswizardcastsafireballonyou": "f",
    "fatasswizardcastsbanishment": "f",
    "fatasswizardcastsbarrier": "f",
    "fatasswizardcastsice": "f",
    "fatasswizardcastslightning": "f",
    "fatasswizardcaststeleportation": "f",
    "fatasswizardcatdrunk": "f",
    "fatasswizardgamba": "f",
    "fatasswizardgoestobed": "f",
    "fatasswizardrose": "f",
    "feelsbitrateman": "f",
    "feelsdankman": "f",
    "feelsdonkman": "f",
    "feelsgladman": "f",
    "feelslagman": "f",
    "feelslateman": "f",
    "feelslockman": "f",
    "feelsoldman": "f",
    "feelsqueueman": "f",
    "feelsrainman": "f",
    "feelswaytoogood": "f",
    "feelsweakman": "f",
    "feelsweirdman": "f",
    "filowtasty": "f",
    "firsttimebackseating": "f",
    "firsttimebot": "f",
    "firsttimechadder": "f",
    "firsttimechatter": "f",
    "firsttimeraider": "f",
    "fishh": "f",
    "flammkuchen": "f",
    "flashbang": "f",
    "flashbang": "f",
    "flush": "f",
    "flushe": "f",
    "flushed": "f",
    "flushedcat": "f",
    "flutetime": "f",
    "forsenautismo": "f",
    "forsencd": "f",
    "forsenparty": "f",
    "fr": "f",
    "fraud": "f",
    "freddypls": "f",
    "freebear": "f",
    "freedom": "f",
    "frenn": "f",
    "frens": "f",
    "frfr": "f",
    "fridge": "f",
    "frogdance": "f",
    "gachi": "g",
    "gachibop": "g",
    "gachihop": "g",
    "gachihopper": "g",
    "gachihyper": "g",
    "gachipride": "g",
    "gamba": "g",
    "gamba2": "g",
    "gambaaddict": "g",
    "gameplaytime": "g",
    "gaming": "g",
    "gayge": "g",
    "gefgef": "g",
    "getoutofmyhead": "g",
    "getouttahere": "g",
    "gg": "g",
    "ghg": "g",
    "gigamods": "g",
    "gigachad": "g",
    "gladge": "g",
    "gladgers": "g",
    "glueless": "g",
    "gomme": "g",
    "gommemode": "g",
    "goodmorning": "g",
    "goodstream": "g",
    "goodtake": "g",
    "goofyahh": "g",
    "gooning": "g",
    "gotcaughttrolling": "g",
    "groupmeeting": "g",
    "guitartime": "g",
    "gunn": "g",
    "guntimer": "g",
    "guysrefreshchatterinoiuploadedanotheremote": "g",
    "hackermans": "h",
    "hahaha": "h",
    "halbebibel": "h",
    "halbebibel": "h",
    "hamster": "h",
    "handsup": "h",
    "happe": "h",
    "happie": "h",
    "happytree": "h",
    "hatechatting": "h",
    "hehe": "h",
    "hewillnever": "h",
    "heyy": "h",
    "hi": "h",
    "hmm": "h",
    "hmmmok": "h",
    "hopium": "h",
    "hugo": "h",
    "huh": "h",
    "hundvonpapaplatte": "h",
    "hurensohn": "h",
    "hyperclap": "h",
    "hypers": "h",
    "icant": "i",
    "icanttakeitanymore": "i",
    "icanttakeitanymore": "i",
    "internetge": "i",
    "jailtime": "j",
    "jamgie": "j",
    "joever": "j",
    "jokergedetected": "j",
    "juicetime": "j",
    "justchattingtime": "j",
    "kapp": "k",
    "kirbyjam": "k",
    "kitten": "k",
    "kittysus": "k",
    "kkalinka": "k",
    "kkomrade": "k",
    "kkonaw": "k",
    "kkool": "k",
    "kok": "k",
    "l": "l",
    "lasttimechatter": "l",
    "latege": "l",
    "lebronjam": "l",
    "leftthand": "l",
    "lethimcook": "l",
    "letsgo": "l",
    "letsgooo": "l",
    "life": "l",
    "lifeisroblox": "l",
    "lipbite": "l",
    "listening": "l",
    "livereaction": "l",
    "lmaooo": "l",
    "loading": "l",
    "lockk": "l",
    "lol": "l",
    "lole": "l",
    "lolw": "l",
    "lookup": "l",
    "love": "l",
    "lovemods": "l",
    "lulw": "l",
    "lurkk": "l",
    "mad": "m",
    "madge": "m",
    "madgeclap": "m",
    "madgelate": "m",
    "madgi": "m",
    "maj": "m",
    "maloche": "m",
    "malphbed": "m",
    "mathtime": "m",
    "meowdy": "m",
    "mexicanos": "m",
    "mexify": "m",
    "mhm": "m",
    "mindtrickge": "m",
    "mitosis": "m",
    "mlady": "m",
    "modcheck": "m",
    "modcheck": "m",
    "modd": "m",
    "modding": "m",
    "modge": "m",
    "monkaban": "m",
    "monkadmca": "m",
    "monkaeyes": "m",
    "monkahmm": "m",
    "monkamath": "m",
    "monkas": "m",
    "monkasteer": "m",
    "monkatos": "m",
    "monkaw": "m",
    "monkax": "m",
    "monke": "m",
    "monkekiss": "m",
    "monkeswim": "m",
    "monkeyinawatermelontrainwtfthisiscrazy": "m",
    "montanablack88": "m",
    "moodge": "m",
    "muga": "m",
    "muted": "m",
    "muted": "m",
    "myexistenceisnothingbutagrainofsandcomparedtotheentirescaleoftheuniverse": "m",
    "myeyes": "m",
    "myhonestreaction": "m",
    "myiq": "m",
    "ncs": "n",
    "nebelniek": "n",
    "nerd": "n",
    "nerdge": "n",
    "nice": "n",
    "nicehost": "n",
    "nodders": "n",
    "noidontthinkso": "n",
    "noonecares": "n",
    "nooo": "n",
    "noooo": "n",
    "nooreax": "n",
    "nopers": "n",
    "notallowed": "n",
    "nothanks": "n",
    "notlistening": "n",
    "notlookingatbooba": "n",
    "nowaying": "n",
    "npc": "n",
    "nt": "n",
    "nyanpls": "n",
    "o7": "o",
    "ofcourse": "o",
    "offline": "o",
    "offlinechat": "o",
    "oh": "o",
    "ohcute": "o",
    "ohhkebab": "o",
    "ohmies": "o",
    "ohno": "o",
    "ohstop": "o",
    "ok": "o",
    "okaygi": "o",
    "okayipullup": "o",
    "okok": "o",
    "oldge": "o",
    "ome": "o",
    "ome": "o",
    "omegadance": "o",
    "omegadancebutfast": "o",
    "omegalul": "o",
    "omegaluliguess": "o",
    "omg": "o",
    "onemore": "o",
    "ono": "o",
    "oooo": "o",
    "outtapocket": "o",
    "pagbounce": "p",
    "pagchomp": "p",
    "pagshake": "p",
    "paidchatter": "p",
    "pain": "p",
    "paluten": "p",
    "papa": "p",
    "papaplatte": "p",
    "parasocialfrenn": "p",
    "partykirby": "p",
    "pause": "p",
    "pausechamp": "p",
    "pauseman": "p",
    "payout": "p",
    "pdffile": "p",
    "peak": "p",
    "pedro": "p",
    "peepoads": "p",
    "peepoarrive": "p",
    "peepobelievers": "p",
    "peepoburnmoney": "p",
    "peepobye": "p",
    "peepochat": "p",
    "peepocheer": "p",
    "peepoclap": "p",
    "peepoclown": "p",
    "peepocozy": "p",
    "peepodj": "p",
    "peepodoubters": "p",
    "peepofeet": "p",
    "peepofinger": "p",
    "peepofree": "p",
    "peepogaze": "p",
    "peepogiggles": "p",
    "peepohey": "p",
    "peepohiddengiggles": "p",
    "peepojammer": "p",
    "peepomine": "p",
    "peeponerd": "p",
    "peepopat": "p",
    "peepopopcorn": "p",
    "peeporiot": "p",
    "peeporun": "p",
    "peeporuncry": "p",
    "peeposadswipe": "p",
    "peeposhower": "p",
    "peeposhrug": "p",
    "peeposhy": "p",
    "peeposithey": "p",
    "peeposmash": "p",
    "peepotalk": "p",
    "peepotalkaustria": "p",
    "peepotoxic": "p",
    "peepovanish": "p",
    "peepowow": "p",
    "peepowtf": "p",
    "pepebass": "p",
    "pepeclown": "p",
    "pepecringe": "p",
    "peped": "p",
    "pepefastjam": "p",
    "pepega": "p",
    "pepegablind": "p",
    "pepegadriving": "p",
    "pepegagun": "p",
    "pepejam": "p",
    "pepejamjam": "p",
    "pepel": "p",
    "pepelaugh": "p",
    "pepemeltdown": "p",
    "pepenoted": "p",
    "pepenpc": "p",
    "pepepoint": "p",
    "pepes": "p",
    "pepesadjam": "p",
    "pepespit": "p",
    "pepodance": "p",
    "pepog": "p",
    "pepojs": "p",
    "pepopopcorn": "p",
    "personwithautism": "p",
    "petthebelievers": "p",
    "petthechat": "p",
    "petthedoubters": "p",
    "petthemods": "p",
    "petthepeepo": "p",
    "pettheraiders": "p",
    "petthestreamer": "p",
    "petthevips": "p",
    "pianotime": "p",
    "piston": "p",
    "pizzatime": "p",
    "please": "p",
    "pog": "p",
    "poggers": "p",
    "poggies": "p",
    "pogo": "p",
    "pogtasty": "p",
    "pogu": "p",
    "pointless": "p",
    "police": "p",
    "police2": "p",
    "popcorntime": "p",
    "poroblunt": "p",
    "pou": "p",
    "ppjedi": "p",
    "ppparty": "p",
    "prayge": "p",
    "praygi": "p",
    "praying": "p",
    "predicting": "p",
    "programming": "p",
    "psp60secondtimeout": "p",
    "qp": "q",
    "que": "q",
    "quicknotes": "q",
    "rage": "r",
    "ragey": "r",
    "rapthis": "r",
    "ratio": "r",
    "ratjam": "r",
    "rave": "r",
    "ravecat": "r",
    "ravedance": "r",
    "realization": "r",
    "reallymad": "r",
    "reeze": "r",
    "resetting": "r",
    "rewi": "r",
    "rewi": "r",
    "righthand": "r",
    "ripbozo": "r",
    "roach": "r",
    "robert": "r",
    "rumathra": "r",
    "rustaceans": "r",
    "sadge": "s",
    "sadgecry": "s",
    "sadgerain": "s",
    "sadgi": "s",
    "sadjam": "s",
    "sadkek": "s",
    "sadmoment": "s",
    "sadtree": "s",
    "saguipls": "s",
    "saj": "s",
    "salutt": "s",
    "saxtime": "s",
    "scamba": "s",
    "scatter": "s",
    "scheming": "s",
    "schizo": "s",
    "schonmalnedickegepopptschere": "s",
    "sexo": "s",
    "sgiggle": "s",
    "shiza": "s",
    "shoo": "s",
    "shrujj": "s",
    "sigma": "s",
    "sillytree": "s",
    "singg": "s",
    "sippin": "s",
    "sisyphus": "s",
    "skaipcall": "s",
    "skip": "s",
    "skype": "s",
    "skypedrunk": "s",
    "skypeemo": "s",
    "skypefinger": "s",
    "skypegiggle": "s",
    "skypenerd": "s",
    "skypenod": "s",
    "skypepuke": "s",
    "skypepunch": "s",
    "skyperock": "s",
    "skypesad": "s",
    "skypesmirk": "s",
    "skypewonder": "s",
    "skypeworried": "s",
    "slapp": "s",
    "smadge": "s",
    "smadging": "s",
    "sniffa": "s",
    "soapcarving": "s",
    "socialcreditsdown": "s",
    "socialcreditsup": "s",
    "speedr": "s",
    "spinning": "s",
    "spinnu0": "s",
    "stab": "s",
    "stare": "s",
    "staree": "s",
    "starman": "s",
    "stegi": "s",
    "stonk": "s",
    "stonks": "s",
    "stopbeingmean": "s",
    "storytime": "s",
    "streamer": "s",
    "streamerdoesntknow": "s",
    "streamoffline": "s",
    "stronge": "s",
    "strongi": "s",
    "suetolog": "s",
    "sure": "s",
    "sus": "s",
    "susgi": "s",
    "suske": "s",
    "sussy": "s",
    "sussy": "s",
    ":tf:": "t",
    "teatime": "t",
    "thevoices": "t",
    "thinkge": "t",
    "thinking": "t",
    "thinking2": "t",
    "thischat": "t",
    "timeout": "t",
    "tomatolix": "t",
    "tomfoolery": "t",
    "toosmart": "t",
    "touchsomegrass": "t",
    "triangd": "t",
    "tridance": "t",
    "trifi": "t",
    "trikool": "t",
    "trimec": "t",
    "trisad": "t",
    "trolldespair": "t",
    "trombonetime": "t",
    "trymacs": "t",
    "tssk": "t",
    "tuckk": "t",
    "!unfollow": "u",
    "uhm": "u",
    "ultramad": "u",
    "um": "u",
    "ummm": "u",
    "unlucky": "u",
    "unlucky": "u",
    "unpaidchatter": "u",
    "uuh": "u",
    "uwu": "u",
    "uwu": "u",
    "uwu": "u",
    "verysadge": "v",
    "vibe": "v",
    "vibee": "v",
    "vibeeparty": "v",
    "vibepls": "v",
    "violintime": "v",
    "vitawirt": "v",
    "voices": "v",
    "volumeup": "v",
    "vs": "v",
    "w": "w",
    "waaaaave": "w",
    "waga": "w",
    "wait": "w",
    "waiting": "w",
    "waitingangry": "w",
    "wandl": "w",
    "wandr": "w",
    "war": "w",
    "watertime": "w",
    "waytoodank": "w",
    "waytooloud": "w",
    "waytoosmart": "w",
    "weirdchamp": "w",
    "weirddude": "w",
    "weirdge": "w",
    "wewaiting": "w",
    "what": "w",
    "whattaahfuck": "w",
    "where": "w",
    "whoasked": "w",
    "whomegalul": "w",
    "wicked": "w",
    "wickedsteer": "w",
    "widealert": "w",
    "widebuhh": "w",
    "widehardo": "w",
    "widepeepohappy": "w",
    "widerave": "w",
    "wielandwelte": "w",
    "wikked": "w",
    "wisemysticaltree": "w",
    "wokege": "w",
    "wooperjam": "w",
    "ww": "w",
    "xar2edm": "x",
    "xd": "x",
    "xdd": "x",
    "xqcmilktime": "x",
    "xylilmaomyassoff": "x",
    "yep": "y",
    "yesidothinkso": "y",
    "yesyes": "y",
    "yoink": "y",
    "yougotme": "y",
    "yourmom": "y",
    "yuumijam": "y",
    "zarbex": "z",
    "zazabert": "z",
    "zidanepog": "z",
    "zyzzbass": "z",
    "zyzzpls": "z",
    "zyzzrave": "z",
# F1 - F12
    "skypegiggle": Key.f1, 
    "skypeworried": Key.f2,
    "skypeemo": Key.f3,
    "skypesmirk": Key.f4,
    "skypewonder": Key.f5,
    "skypefinger": Key.f6,
    "skypesad": Key.f7,
    "skypepuke": Key.f8,
    "skypenerd": Key.f9,
    "skypedrunk": Key.f10,
    "skyperock": Key.f11,
    "skypepunch": Key.f12,
# Special Keys
    "stegi": Key.shift,
    "hugo": Key.ctrl, 
    "chaosflo": Key.alt, 
    "mexify": Key.tab,
    "wielandwelte": Key.space, 
    "rewi": Key.esc, 
# Mouse Controls
    "papaplatte": "left_click", 
    "faister": "right_click", 
    "fatasswizardcaststeleportation": "90", 
    "fatasswizardcastslightning": "180",
    "fatasswizardcastsice": "360", 
    "happytree": "up", 
    "sadtree": "down", 
    "sillytree": "left", 
    "wisemysticaltree": "right",
}

keyboard = KeyboardController()
mouse = MouseController()

class Bot(commands.Bot):
    def __init__(self):
        super().__init__(token=OAUTH_TOKEN, prefix="!",initial_channels=[CHANNEL])
        self.chat_messages = []
    
    async def event_message(self, message):
        self.chat_messages.append(message.content)

def mouse_mover(x,y,steps,pause):
    for _ in range(steps*7):
        mouse.move(x, y)
        time.sleep(pause)

async def read_chat():
    bot = Bot()
    asyncio.create_task(bot.start())

    while True:
        await asyncio.sleep(INTERVAL)

        if bot.chat_messages:
            filtered_messages = [KEY_MAPPING.get(msg.lower()) for msg in bot.chat_messages]
            counter = Counter(filtered_messages)

            if counter:
                most_common_command,count = counter.most_common(1)[0]
                print(most_common_command,count)
                if most_common_command:
                    if most_common_command in ["90", "180", "360"]:
                        mouse_mover(1,0,int(most_common_command), 0.0001)
                    elif most_common_command in ["up", "down", "left", "right"]:
                        if most_common_command == "up":
                            mouse_mover(0,-1,800, 0.0002)
                        if most_common_command == "down":
                            mouse_mover(0,1,800, 0.0002)
                        if most_common_command == "left":
                            mouse_mover(-1,0,800, 0.0002)
                        if most_common_command == "right":
                            mouse_mover(1,0,800, 0.0002)
                    elif most_common_command == "left_click":
                        for i in range(random.randint(1,5)):
                            mouse.press(Button.left)
                            time.sleep(random.uniform(1, 5))
                            mouse.release(Button.left)
                    elif most_common_command == "right_click":
                        for i in range(random.randint(1,5)):
                            mouse.press(Button.right)
                            time.sleep(random.uniform(1, 5))
                            mouse.release(Button.right)
                    else:
                        keyboard.press(most_common_command)
                        time.sleep(random.uniform(1, 5))
                        keyboard.release(most_common_command)
            bot.chat_messages.clear()

if __name__ == "__main__":
    asyncio.run(read_chat())